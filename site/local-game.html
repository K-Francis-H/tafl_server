<!DOCTYPE html>
<html>
	<head>
		<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon"/>
		<meta charset="utf-8">
		<title>Tafl Games</title>
		<link rel="stylesheet" type="text/css" href="style/notation.css">
		<script src="TaflBoard.js"></script>
		<script src="TaflRenderer.js"></script>
		<script src="TaflGameLocal.js"></script>
		<script src="EaldfaederRules.js"></script>
		<script src="FetlarRules.js"></script>
		<script src="CopenhagenRules.js"></script>
		<script src="ClevelandRules.js"></script>
		<script src="TaflNotator.js"></script>
		<script>
			document.addEventListener("DOMContentLoaded", function(){
				//var board = new TaflBoard(TaflBoard.BRANDUBH);
				//var renderer = new TaflRenderer(document.getElementById("canvas"));
				//renderer.draw(board);
				//var editor = new TaflBoardEditor(document.getElementById("canvas"), TaflBoard.BRANDUBH);
				var url = new URL(document.URL);
				var variant = url.searchParams.get("variant");
				var rules = resolveRuleSet(url.searchParams.get("rules"));
	
				var notator = new TaflNotator(TaflBoard[variant], variant, rules, "notation");

				document.getElementById("variant").innerText = capitalize(variant);
				document.getElementById("playing-as").innerText = "Local game";
				//handles sending back game state data for UI display
				var callback = {
					//never used by local games
					setPlayer : function(player){
						document.getElementById("playing-as").innerText = "Playing as "+resolvePlayer(player, false);
					},

					onGameOver : function(winner){
						document.getElementById("to-play").innerText = resolvePlayer(winner, true)+" wins!";
					},
	
					onTurnChange : function(player){
						document.getElementById("to-play").innerText = resolvePlayer(player, true)+" to play";
					},

					onMove : function(move){
						notator.addMove(move);
					}
				};

				if(variant){
					variant = variant.toUpperCase();
					var localGame = new TaflGameLocal(document.getElementById("canvas"), TaflBoard[variant], rules, callback);
				}else{
					//bad...
					//redirect to main page
					window.location.replace("/");
				}
			});

			function resolvePlayer(player, isUppercase){
				switch(player){
					case B: return isUppercase ? "Black" : "black";
					case W: return isUppercase ? "White" : "white";
					default: return "???";
				}
			}

			function resolveRuleSet(value){
				switch(value){
					case "fetlar":
						return new FetlarRules();
					case "copenhagen":
						return new CopenhagenRules();
					case "ealdfaeder":
						return new EaldfaederRules();
					case "cleveland":
					default:
						return new ClevelandRules();
				}
			}

			function capitalize(str){
				return str[0].toUpperCase() + str.substr(1);
			}
		</script>
	</head>
	<body>
		<a href="/">New Game</a>
		<center>
			<div id="game-container" style="display:inline-block">
				<h1 id="variant"></h1>
				<h3 id="playing-as"></h3>
				<h3 id="to-play"></h3>
				<canvas id="canvas" draggable="true" width=800 height=800></canvas>
				<h4 id="share-label" style="display:none;">Join Link:</h4>
				<input id="shareable-join-link" readonly style="display:none;"/>
				<button id="copy-button" style="display:none;">Copy</button>
			</div>
			<div style="display:inline-block;vertical-align:top">
				<ol id=notation></ol>
				<!--<p>what the fuck 1</p><p>what the fuck 2</p><p>what the fuck 3</p><p>what the fuck 4</p><p>what the fuck 5</p>-->
			</div>
		</center>
	</body>
</html>
